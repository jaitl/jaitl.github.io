<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Bean Validation в Spring на практике - Jaitl's blog</title><meta name=description content="Статья демонстрирует основные возможности Bean Validation интегрированные в Spring на практических примерах. Статья подразумевает, что вы знакомы с теорией по Bean Validation и хотите лучше понять библиотеку на практике."><meta name=author content="Jaitl"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Jaitl\u0027s blog","url":"https:\/\/jaitl.pro"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/jaitl.pro"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/jaitl.pro","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/jaitl.pro\/post\/2023-04-24-spring-bean-validation-in-practice\/","name":"Bean validation в spring на практике"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Jaitl"},"headline":"Bean Validation в Spring на практике","description":"Статья демонстрирует основные возможности Bean Validation интегрированные в Spring на практических примерах. Статья подразумевает, что вы знакомы с теорией по Bean Validation и хотите лучше понять библиотеку на практике.\n","inLanguage":"en","wordCount":1545,"datePublished":"2023-04-24T12:00:00","dateModified":"2023-04-24T12:00:00","image":"https:\/\/jaitl.pro\/img\/jaitl-avatar.png","keywords":[""],"mainEntityOfPage":"https:\/\/jaitl.pro\/post\/2023-04-24-spring-bean-validation-in-practice\/","publisher":{"@type":"Organization","name":"https:\/\/jaitl.pro","logo":{"@type":"ImageObject","url":"https:\/\/jaitl.pro\/img\/jaitl-avatar.png","height":60,"width":60}}}</script><meta property="og:title" content="Bean Validation в Spring на практике"><meta property="og:description" content="Статья демонстрирует основные возможности Bean Validation интегрированные в Spring на практических примерах. Статья подразумевает, что вы знакомы с теорией по Bean Validation и хотите лучше понять библиотеку на практике."><meta property="og:image" content="https://jaitl.pro/img/jaitl-avatar.png"><meta property="og:url" content="https://jaitl.pro/post/2023-04-24-spring-bean-validation-in-practice/"><meta property="og:type" content="website"><meta property="og:site_name" content="Jaitl's blog"><meta name=twitter:title content="Bean Validation в Spring на практике"><meta name=twitter:description content="Статья демонстрирует основные возможности Bean Validation интегрированные в Spring на практических примерах. Статья подразумевает, что вы знакомы с теорией по Bean Validation и хотите лучше понять …"><meta name=twitter:image content="https://jaitl.pro/img/jaitl-avatar.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@jaitl"><meta name=twitter:creator content="@jaitl"><link href=https://jaitl.pro/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.111.3"><link rel=alternate href=https://jaitl.pro/index.xml type=application/rss+xml title="Jaitl's blog"><link rel=stylesheet href=https://jaitl.pro/css/katex.min.css><link rel=stylesheet href=https://jaitl.pro/fontawesome/css/all.css><link rel=stylesheet href=https://jaitl.pro/css/bootstrap.min.css><link rel=stylesheet href=https://jaitl.pro/css/main.css><link rel=stylesheet href=https://jaitl.pro/css/fonts.css><link rel=stylesheet href=https://jaitl.pro/css/syntax.css><link rel=stylesheet href=https://jaitl.pro/css/codeblock.css><link rel=stylesheet href=https://jaitl.pro/css/photoswipe.min.css><link rel=stylesheet href=https://jaitl.pro/css/photoswipe.default-skin.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-KBJ7QRKR1F"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KBJ7QRKR1F",{anonymize_ip:!1})}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://jaitl.pro>Jaitl's blog</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Notes href=/notes>Notes</a></li><li><a title=Telegram href=https://t.me/seniorsITBlog>Telegram</a></li><li><a title=About href=/about>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Jaitl's blog" href=https://jaitl.pro><img class=avatar-img src=https://jaitl.pro/img/jaitl-avatar.png alt="Jaitl's blog"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><div class=post-heading><h1>Bean Validation в Spring на практике</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on April 24, 2023
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1545&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Jaitl</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Статья демонстрирует основные возможности <a href=https://beanvalidation.org/>Bean Validation</a> интегрированные в Spring на практических примерах. Статья подразумевает, что вы знакомы с теорией по <code>Bean Validation</code> и хотите лучше понять библиотеку на практике.</p><p>В статье примеры реализованы на <code>Spring Boot 3</code> и <code>Spring 6</code>, поэтому все Jakarta EE (Java EE) классы импортируются из пакета <code>jakarta.validation.*</code>. Примеры совместимы с предыдущей версией <code>Spring</code> в который классы импортируются из пакета <code>javax.validation.*</code>.</p><p>Я пропустил документацию по аннотациям ограничений (<code>jakarta.validation.constraints.*</code>), так как аннотаций достаточно много и они подробно описаны в официальной документации и многих других статьях.</p><h1 id=типы-валидации>Типы валидации</h1><h2 id=валидация-входных-данных-контроллера>Валидация входных данных контроллера</h2><p>Главной аннотацией в <a href=https://beanvalidation.org/>Bean Validation</a> является аннотация <code>@Valid</code>.
С помощью нее активируется автоматическая валидация бинов.</p><p>Для валидации входных данных контроллера аннотация <code>@Valid</code> ставится перед входными аргументами методов в контроллере.
Если валидируемый бин в качестве поля содержит другой бин, который тоже требуют валидировать, то поле с бином так же необходимо пометить аннотацией <code>@Valid</code>.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/request/CreateInputRequest.java>CreateInputRequest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateInputRequest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Size</span><span class=o>(</span><span class=n>max</span> <span class=o>=</span> <span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Min</span><span class=o>(</span><span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Integer</span> <span class=n>inputId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Valid</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>AttachmentDto</span> <span class=n>attachment</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/dto/AttachmentDto.java>AttachmentDto</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AttachmentDto</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Max</span><span class=o>(</span><span class=mi>255</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/InputController.java>InputController</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/v1/inputs&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>InputController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>CreateInputRequest</span> <span class=n>request</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;create request: {}&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Преобразование ошибок <code>Bean Validator</code> в HTTP ошибки <code>Spring REST</code> выполняется с помощью кастомного обработчика исключений.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/advice/GlobalExceptionHandler.java>GlobalExceptionHandler</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestControllerAdvice</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GlobalExceptionHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@ExceptionHandler</span><span class=o>(</span><span class=n>MethodArgumentNotValidException</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span> <span class=nf>handleValidationErrors</span><span class=o>(</span><span class=n>MethodArgumentNotValidException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>fieldErrors</span> <span class=o>=</span> <span class=n>ex</span><span class=o>.</span><span class=na>getFieldErrors</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>e</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getField</span><span class=o>(),</span> <span class=n>e</span><span class=o>.</span><span class=na>getDefaultMessage</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>globalErrors</span> <span class=o>=</span> <span class=n>ex</span><span class=o>.</span><span class=na>getGlobalErrors</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>e</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getObjectName</span><span class=o>(),</span> <span class=n>e</span><span class=o>.</span><span class=na>getDefaultMessage</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>error</span> <span class=o>=</span> <span class=n>Stream</span><span class=o>.</span><span class=na>concat</span><span class=o>(</span><span class=n>fieldErrors</span><span class=o>,</span> <span class=n>globalErrors</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>(</span><span class=s>&#34;, &#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ErrorResponse</span> <span class=n>response</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ErrorResponse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=na>setCode</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>BAD_REQUEST</span><span class=o>.</span><span class=na>value</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=na>setError</span><span class=o>(</span><span class=n>error</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>ResponseEntity</span><span class=o>&lt;&gt;(</span><span class=n>response</span><span class=o>,</span> <span class=k>new</span> <span class=n>HttpHeaders</span><span class=o>(),</span> <span class=n>HttpStatus</span><span class=o>.</span><span class=na>BAD_REQUEST</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/controller/InputControllerTest.java>InputControllerTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>InputControllerTest</span> <span class=kd>extends</span> <span class=n>BaseApiTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testInput_Valid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AttachmentDto</span> <span class=n>attachmentDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AttachmentDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>attachmentDto</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;some_bite_content&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CreateInputRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CreateInputRequest</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;newInputValidTest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setAttachment</span><span class=o>(</span><span class=n>attachmentDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/inputs&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isOk</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testInput_Invalid_InputId</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AttachmentDto</span> <span class=n>attachmentDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AttachmentDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>attachmentDto</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;some_bite_content&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CreateInputRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CreateInputRequest</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;newInputValidTest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setAttachment</span><span class=o>(</span><span class=n>attachmentDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/inputs&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isBadRequest</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=s>&#34;inputId: must be greater than or equal to 0&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testInput_Invalid_Attachment</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AttachmentDto</span> <span class=n>attachmentDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AttachmentDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>attachmentDto</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CreateInputRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CreateInputRequest</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;newInputValidTest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setAttachment</span><span class=o>(</span><span class=n>attachmentDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/inputs&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isBadRequest</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=s>&#34;attachment.content: must not be null&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=валидация-spring-data-entity>Валидация Spring Data Entity</h2><p><code>Bean Validation</code> умеет валидировать <code>Spring Data Entity</code> перед вставкой в БД.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/repository/InputEntity.java>InputEntity</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span>
</span></span><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>InputEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Id</span>
</span></span><span class=line><span class=cl>    <span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>IDENTITY</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Integer</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Size</span><span class=o>(</span><span class=n>max</span> <span class=o>=</span> <span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Min</span><span class=o>(</span><span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Integer</span> <span class=n>inputId</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/repository/InputRepository.java>InputRepository</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>InputRepository</span> <span class=kd>extends</span> <span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>InputEntity</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/repository/InputRepositoryTest.java>InputRepositoryTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>InputRepositoryTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>InputRepository</span> <span class=n>inputRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testSave_Success</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputEntity</span> <span class=n>entity</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputEntity</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertDoesNotThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>inputRepository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>entity</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testSave_Failed</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputEntity</span> <span class=n>entity</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputEntity</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintViolationException</span> <span class=n>e</span> <span class=o>=</span> <span class=n>assertThrows</span><span class=o>(</span><span class=n>ConstraintViolationException</span><span class=o>.</span><span class=na>class</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>inputRepository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>entity</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>constraintViolations</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>getConstraintViolations</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>v</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>v</span><span class=o>.</span><span class=na>getPropertyPath</span><span class=o>().</span><span class=na>toString</span><span class=o>(),</span> <span class=n>v</span><span class=o>.</span><span class=na>getMessage</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toSet</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;name: must not be null&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;inputId: must be greater than or equal to 0&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=валидация-входных-данных-сервиса>Валидация входных данных сервиса</h2><p><code>Bean Validation</code> умеет валидировать входные аргументы методов сервиса.
Для этого над сервисом ставится аннотация <code>@Validated</code>, а перед аргументами аннотация <code>@Valid</code>.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/service/InputService.java>InputService</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=nd>@Validated</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>InputService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handle</span><span class=o>(</span><span class=nd>@Valid</span> <span class=n>InputEntity</span> <span class=n>inputEntity</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;entity: {}&#34;</span><span class=o>,</span> <span class=n>inputEntity</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/service/InputServiceTest.java>InputServiceTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>InputServiceTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>InputService</span> <span class=n>inputService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testHandle_Success</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputEntity</span> <span class=n>entity</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputEntity</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertDoesNotThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>inputService</span><span class=o>.</span><span class=na>handle</span><span class=o>(</span><span class=n>entity</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testHandle_Failed_InvalidInput</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputEntity</span> <span class=n>entity</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputEntity</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span><span class=mi>2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>entity</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintViolationException</span> <span class=n>e</span> <span class=o>=</span> <span class=n>assertThrows</span><span class=o>(</span><span class=n>ConstraintViolationException</span><span class=o>.</span><span class=na>class</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>inputService</span><span class=o>.</span><span class=na>handle</span><span class=o>(</span><span class=n>entity</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>constraintViolations</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>getConstraintViolations</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>v</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>v</span><span class=o>.</span><span class=na>getPropertyPath</span><span class=o>(),</span> <span class=n>v</span><span class=o>.</span><span class=na>getMessage</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toSet</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handle.inputEntity.name: must not be null&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handle.inputEntity.inputId: must be greater than or equal to 0&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=явная-валидация>Явная валидация</h2><p>Для явной валидации используется класс <code>jakarta.validation.Validator</code>.
Явная валидация позволяет разработать кастомную логику обработки ошибок валидации бинов.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/ValidationTest.java>ValidationTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>ValidationTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Validator</span> <span class=n>validator</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testValidate_Success</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AttachmentDto</span> <span class=n>attachmentDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AttachmentDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>attachmentDto</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;some_bite_content&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CreateInputRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CreateInputRequest</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;newInputValidTest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setAttachment</span><span class=o>(</span><span class=n>attachmentDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>ConstraintViolation</span><span class=o>&lt;</span><span class=n>CreateInputRequest</span><span class=o>&gt;&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>validator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=n>request</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testValidate_Invalid_InputId</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>AttachmentDto</span> <span class=n>attachmentDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AttachmentDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>attachmentDto</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;some_bite_content&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CreateInputRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CreateInputRequest</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setInputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;newInputValidTest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=na>setAttachment</span><span class=o>(</span><span class=n>attachmentDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>List</span><span class=o>&lt;</span><span class=n>ConstraintViolation</span><span class=o>&lt;</span><span class=n>CreateInputRequest</span><span class=o>&gt;&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>List</span><span class=o>.</span><span class=na>copyOf</span><span class=o>(</span><span class=n>validator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=n>request</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>assertEquals</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=n>result</span><span class=o>.</span><span class=na>size</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintViolation</span><span class=o>&lt;</span><span class=n>CreateInputRequest</span><span class=o>&gt;</span> <span class=n>validationResult</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;inputId&#34;</span><span class=o>,</span> <span class=n>validationResult</span><span class=o>.</span><span class=na>getPropertyPath</span><span class=o>().</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;must be greater than or equal to 0&#34;</span><span class=o>,</span> <span class=n>validationResult</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=группы-валидации>Группы валидации</h1><p><code>Bean Validation</code> позволяет делить валидаторы полей на группы под разные юзкейсы.
Например, для использования одного и того же DTO для создания и обновления сущностей в контроллере, можно маркировать валидаторы которые выполняются при создании сущностей одной группой, а валидаторы которые выполняются при изменении сущностей другой группой.</p><p>Группы валидации разделяются через пустые интерфейсы:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>OnCreateGroup</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>OnUpdateGroup</span> <span class=o>{}</span>
</span></span></code></pre></div><p>Затем интерфейсы используются как маркеры для групп.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/dto/OutputDto.java>OutputDto</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OutputDto</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>groups</span> <span class=o>=</span> <span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Size</span><span class=o>(</span><span class=n>max</span> <span class=o>=</span> <span class=mi>20</span><span class=o>,</span> <span class=n>groups</span> <span class=o>=</span> <span class=o>{</span><span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>OnUpdateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>})</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>groups</span> <span class=o>=</span> <span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Min</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=mi>0</span><span class=o>,</span> <span class=n>groups</span> <span class=o>=</span> <span class=o>{</span><span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>OnUpdateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>})</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Integer</span> <span class=n>outputId</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=валидация-входных-данных-контроллера-1>Валидация входных данных контроллера</h2><p>Валидация полей по группам выполняется с помощью аннотации <code>@Validated</code> с указанием группы.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/OutputController.java>OutputController</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/v1/outputs&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OutputController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>(</span><span class=nd>@Validated</span><span class=o>(</span><span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=nd>@RequestBody</span> <span class=n>OutputDto</span> <span class=n>outputDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;create request: {}&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@PutMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>update</span><span class=o>(</span><span class=nd>@Validated</span><span class=o>(</span><span class=n>OnUpdateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=nd>@RequestBody</span> <span class=n>OutputDto</span> <span class=n>outputDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;update request: {}&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/controller/OutputControllerTest.java>OutputControllerTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OutputControllerTest</span> <span class=kd>extends</span> <span class=n>BaseApiTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Create_Valid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/outputs&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isOk</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Create_Invalid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/outputs&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isBadRequest</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>containsString</span><span class=o>(</span><span class=s>&#34;outputId: must not be null&#34;</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>containsString</span><span class=o>(</span><span class=s>&#34;name: must not be null&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Update_Valid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPut</span><span class=o>(</span><span class=s>&#34;/v1/outputs&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isOk</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Update_Invalid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;it&#39;s longer than 20 characters&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPut</span><span class=o>(</span><span class=s>&#34;/v1/outputs&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>containsString</span><span class=o>(</span><span class=s>&#34;outputId: must be greater than or equal to 0&#34;</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>containsString</span><span class=o>(</span><span class=s>&#34;name: size must be between 0 and 20&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=валидация-входных-данных-сервиса-1>Валидация входных данных сервиса</h2><p>Валидация входных аргументов методов сервиса выполняется несколько иначе.</p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/service/OutputService.java>OutputService</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Validated</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OutputService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Validated</span><span class=o>(</span><span class=n>OnCreateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleCreate</span><span class=o>(</span><span class=nd>@Valid</span> <span class=n>OutputDto</span> <span class=n>outputDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;create request: {}&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Validated</span><span class=o>(</span><span class=n>OnUpdateGroup</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleUpdate</span><span class=o>(</span><span class=nd>@Valid</span> <span class=n>OutputDto</span> <span class=n>outputDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;update request: {}&#34;</span><span class=o>,</span> <span class=n>outputDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/service/OutputServiceTest.java>OutputControllerTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OutputServiceTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>OutputService</span> <span class=n>outputService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Create_Valid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertDoesNotThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>outputService</span><span class=o>.</span><span class=na>handleCreate</span><span class=o>(</span><span class=n>outputDto</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Create_Invalid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintViolationException</span> <span class=n>e</span> <span class=o>=</span> <span class=n>assertThrows</span><span class=o>(</span><span class=n>ConstraintViolationException</span><span class=o>.</span><span class=na>class</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>outputService</span><span class=o>.</span><span class=na>handleCreate</span><span class=o>(</span><span class=n>outputDto</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>constraintViolations</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>getConstraintViolations</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>v</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>v</span><span class=o>.</span><span class=na>getPropertyPath</span><span class=o>(),</span> <span class=n>v</span><span class=o>.</span><span class=na>getMessage</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toSet</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handleCreate.outputDto.name: must not be null&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handleCreate.outputDto.outputId: must be greater than or equal to 0&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Update_Valid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertDoesNotThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>outputService</span><span class=o>.</span><span class=na>handleUpdate</span><span class=o>(</span><span class=n>outputDto</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testOutput_Update_Invalid</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputDto</span> <span class=n>outputDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;it&#39;s longer than 20 characters&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outputDto</span><span class=o>.</span><span class=na>setOutputId</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintViolationException</span> <span class=n>e</span> <span class=o>=</span> <span class=n>assertThrows</span><span class=o>(</span><span class=n>ConstraintViolationException</span><span class=o>.</span><span class=na>class</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>outputService</span><span class=o>.</span><span class=na>handleCreate</span><span class=o>(</span><span class=n>outputDto</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>constraintViolations</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>getConstraintViolations</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>v</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s: %s&#34;</span><span class=o>,</span> <span class=n>v</span><span class=o>.</span><span class=na>getPropertyPath</span><span class=o>(),</span> <span class=n>v</span><span class=o>.</span><span class=na>getMessage</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toSet</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handleCreate.outputDto.name: size must be between 0 and 20&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>constraintViolations</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;handleCreate.outputDto.outputId: must be greater than or equal to 0&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=кастомный-валидатор>Кастомный валидатор</h1><h2 id=кастомная-аннотация>Кастомная аннотация</h2><p>Кастомный валидатор состоит из кастомной аннотации и реализации интерфейса для валидации.</p><p>Кастомный валидатор позволяет валидировать отдельные поля бина или весь бин целиком. Для валидации всего бина кастомная аннотация ставится над классом этого бина.</p><p>Ниже приведен пример реализации кастомного валидатора, валидирующего бин целиком.</p><p>Кастомная аннотация <a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/custom/FacadeHasPattern.java>FacadeHasPattern</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=o>({</span><span class=n>ElementType</span><span class=o>.</span><span class=na>TYPE</span><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=nd>@Constraint</span><span class=o>(</span><span class=n>validatedBy</span><span class=o>=</span> <span class=n>FacadeHasPatternValidator</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Documented</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>FacadeHasPattern</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>message</span><span class=o>()</span> <span class=k>default</span> <span class=s>&#34;Facade fields don&#39;t have the string pattern&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>groups</span><span class=o>()</span> <span class=k>default</span> <span class=o>{};</span>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Payload</span><span class=o>&gt;[]</span> <span class=nf>payload</span><span class=o>()</span> <span class=k>default</span> <span class=o>{};</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>stringPattern</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Реализация кастомного валидатора <a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/custom/FacadeHasPatternValidator.java>FacadeHasPatternValidator</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FacadeHasPatternValidator</span> <span class=kd>implements</span> <span class=n>ConstraintValidator</span><span class=o>&lt;</span><span class=n>FacadeHasPattern</span><span class=o>,</span> <span class=n>FacadeDto</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>stringPattern</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=o>(</span><span class=n>FacadeHasPattern</span> <span class=n>constraintAnnotation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stringPattern</span> <span class=o>=</span> <span class=n>constraintAnnotation</span><span class=o>.</span><span class=na>stringPattern</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValid</span><span class=o>(</span><span class=n>FacadeDto</span> <span class=n>value</span><span class=o>,</span> <span class=n>ConstraintValidatorContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>value</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>value</span><span class=o>.</span><span class=na>getDescription</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>value</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>getDescription</span><span class=o>().</span><span class=na>contains</span><span class=o>(</span><span class=n>stringPattern</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>value</span><span class=o>.</span><span class=na>getName</span><span class=o>().</span><span class=na>contains</span><span class=o>(</span><span class=n>stringPattern</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/dto/FacadeDto.java>FacadeDto</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FacadeHasPattern</span><span class=o>(</span><span class=n>stringPattern</span> <span class=o>=</span> <span class=s>&#34;aaa&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FacadeDto</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/FacadeController.java>FacadeController</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/v1/facades&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FacadeController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>FacadeDto</span> <span class=n>facadeDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;create request: {}&#34;</span><span class=o>,</span> <span class=n>facadeDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/controller/FacadeControllerTest.java>FacadeControllerTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>FacadeControllerTest</span> <span class=kd>extends</span> <span class=n>BaseApiTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testFacadeCreate_Valid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FacadeDto</span> <span class=n>facadeDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FacadeDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>facadeDto</span><span class=o>.</span><span class=na>setDescription</span><span class=o>(</span><span class=s>&#34;test aaa&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>facadeDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test aaa&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/facades&#34;</span><span class=o>,</span> <span class=n>facadeDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isOk</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testFacadeCreate_Invalid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FacadeDto</span> <span class=n>facadeDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FacadeDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>facadeDto</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>facadeDto</span><span class=o>.</span><span class=na>setDescription</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/facades&#34;</span><span class=o>,</span> <span class=n>facadeDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isBadRequest</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=s>&#34;facadeDto: Facade fields don&#39;t have the string pattern&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=аннотация-asserttrue>Аннотация @AssertTrue</h2><p>Костыльнй метод валидации, которым не стоит пользоваться.
Аннотация <code>@AssertTrue</code> ставится над методом в классе, который валидирует весь бин.
Существует зеркальная аннотация - <code>@AssertFalse</code>.</p><p>Имя метода должно начинаться с <code>is</code>. Например: <code>isValid()</code></p><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/dto/DoorDto.java>DoorDto</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DoorDto</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>materialType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>lockType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@AssertTrue</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;Unreliable door&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValidDoor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>materialType</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;steel&#34;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>lockType</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;digital&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/main/java/pro/jaitl/spring/examples/validation/controller/DoorController.java>DoorController</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/v1/doors&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DoorController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>DoorDto</span> <span class=n>doorDto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;create request: {}&#34;</span><span class=o>,</span> <span class=n>doorDto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://github.com/jaitl/spring-examples/blob/main/spring-validation/src/test/java/pro/jaitl/spring/examples/validation/controller/DoorControllerTest.java>DoorControllerTest</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>DoorControllerTest</span> <span class=kd>extends</span> <span class=n>BaseApiTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testFacadeCreate_Valid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoorDto</span> <span class=n>doorDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DoorDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>doorDto</span><span class=o>.</span><span class=na>setMaterialType</span><span class=o>(</span><span class=s>&#34;steel&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>doorDto</span><span class=o>.</span><span class=na>setLockType</span><span class=o>(</span><span class=s>&#34;digital&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/doors&#34;</span><span class=o>,</span> <span class=n>doorDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isOk</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testFacadeCreate_Invalid</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoorDto</span> <span class=n>doorDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DoorDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>doorDto</span><span class=o>.</span><span class=na>setMaterialType</span><span class=o>(</span><span class=s>&#34;wood&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>doorDto</span><span class=o>.</span><span class=na>setLockType</span><span class=o>(</span><span class=s>&#34;key&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mockMvc</span><span class=o>.</span><span class=na>perform</span><span class=o>(</span><span class=n>doPost</span><span class=o>(</span><span class=s>&#34;/v1/doors&#34;</span><span class=o>,</span> <span class=n>doorDto</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>status</span><span class=o>().</span><span class=na>isBadRequest</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.code&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=mi>400</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>andExpect</span><span class=o>(</span><span class=n>jsonPath</span><span class=o>(</span><span class=s>&#34;$.error&#34;</span><span class=o>,</span> <span class=n>equalTo</span><span class=o>(</span><span class=s>&#34;validDoor: Unreliable door&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=источники>Источники:</h1><ul><li><a href=https://www.amazon.com/Pro-Spring-Depth-Guide-Framework/dp/1484228073>Pro Spring 5</a></li><li><a href=https://reflectoring.io/bean-validation-with-spring-boot/>Validation with Spring Boot - the Complete Guide</a></li><li><a href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/?v=8.0">Hibernate Validator 8.0.0.Final - Jakarta Bean Validation Reference Implementation: Reference Guide</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://jaitl.pro/russian/2022/12/26/spring-data-jpa-batch/ data-toggle=tooltip data-placement=top title="Батчевое сохранение данных в Spring Data JPA">&larr; Previous Post</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/jaitl title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/jaitl title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://jaitl.pro>Jaitl</a>
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://jaitl.pro>Jaitl's blog</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.111.3</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://jaitl.pro/js/katex.min.js></script>
<script src=https://jaitl.pro/js/auto-render.min.js></script>
<script src=https://jaitl.pro/js/jquery-3.5.1.slim.min.js></script>
<script src=https://jaitl.pro/js/bootstrap.min.js></script>
<script src=https://jaitl.pro/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://jaitl.pro/js/photoswipe.min.js></script>
<script src=https://jaitl.pro/js/photoswipe-ui-default.min.js></script><script src=https://jaitl.pro/js/load-photoswipe.js></script></body></html>